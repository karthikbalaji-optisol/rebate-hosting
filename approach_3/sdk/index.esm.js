var e=function(){return e=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},e.apply(this,arguments)};function t(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function d(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,d)}c((r=r.apply(e,t||[])).next())})}function n(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=d(0),a.throw=d(1),a.return=d(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function d(d){return function(c){return function(d){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,d[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&d[0]?r.return:d[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,d[1])).done)return o;switch(r=0,o&&(d=[2&d[0],o.value]),d[0]){case 0:case 1:o=d;break;case 4:return i.label++,{value:d[1],done:!1};case 5:i.label++,r=d[1],d=[0];continue;case 7:d=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==d[0]&&2!==d[0])){i=0;continue}if(3===d[0]&&(!o||d[1]>o[0]&&d[1]<o[3])){i.label=d[1];break}if(6===d[0]&&i.label<o[1]){i.label=o[1],o=d;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(d);break}o[2]&&i.ops.pop(),i.trys.pop();continue}d=t.call(e,i)}catch(e){d=[6,e],r=0}finally{n=o=0}if(5&d[0])throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}([d,c])}}}"function"==typeof SuppressedError&&SuppressedError;var r="https://rebate-sdk-api-test.optisolbusiness.com/mock_server/card";function o(e,t,n){var r=document.createElement(e);return t&&(r.className=t),void 0!==n&&(r.innerHTML=n),r}function i(e,t){Object.assign(e.style,t)}var a={cardholderName:"John Doe",cardNumber:"4532 1234 5678 4242",cvv:"123",expiry:"01/30"},d=function(){function d(e){if(this.container=null,this.rootEl=null,!e||!e.containerId)throw new Error("RebateSDK: containerId is required");this.cfg=e}return d.prototype.mount=function(){return t(this,void 0,void 0,function(){var e,t,r;return n(this,function(n){switch(n.label){case 0:if(!(e=document.getElementById(this.cfg.containerId)))throw new Error("Container with id ".concat(this.cfg.containerId," not found"));return this.container=e,e.innerHTML="",i(t=o("div","onbe-rebate-root"),{fontFamily:"Arial, sans-serif",width:"100%",maxWidth:"400px",margin:"0 auto"}),r=o("div","onbe-rebate-card-holder"),t.appendChild(r),e.appendChild(t),this.rootEl=t,[4,this.showTermsFlow()];case 1:return n.sent(),[2]}})})},d.prototype.showTermsFlow=function(){return t(this,void 0,void 0,function(){return n(this,function(e){switch(e.label){case 0:return this.showLoadingBar("Loading terms..."),[4,new Promise(function(e){return setTimeout(e,800)})];case 1:return e.sent(),this.hideLoadingBar(),[4,this.showTermsAndConditions()];case 2:return e.sent(),[2]}})})},d.prototype.showTermsAndConditions=function(){return t(this,void 0,void 0,function(){var e=this;return n(this,function(t){return[2,new Promise(function(t){if(e.rootEl){var n=e.rootEl.querySelector(".onbe-rebate-card-holder");if(n){n.innerHTML="";var r=o("div","onbe-terms-container");i(r,{padding:"20px",maxWidth:"100%"});var a=o("h3","onbe-terms-title","Terms & Conditions");i(a,{fontSize:"18px",fontWeight:"600",margin:"0 0 12px 0",textAlign:"center",color:"#333"});var d=o("p","onbe-terms-desc","To receive your refund as a virtual card, please review and accept our terms and conditions.");i(d,{fontSize:"14px",color:"#666",marginBottom:"16px",lineHeight:"1.6"});var c=o("div","onbe-links-box");i(c,{background:"#f9fafb",padding:"16px",borderRadius:"8px",marginBottom:"16px"});var s=o("p","onbe-links-text","By accepting, you agree to receive your refund as a virtual prepaid card. Please read our policies:");i(s,{fontSize:"13px",color:"#555",marginBottom:"12px",lineHeight:"1.5",margin:"0 0 12px 0"});var l=o("div","onbe-links-wrapper");i(l,{display:"flex",gap:"16px",flexWrap:"wrap"});var p=o("a","onbe-terms-link","Terms of Service →");p.setAttribute("href","#"),p.setAttribute("target","_blank"),i(p,{color:e.cfg.primaryColor||"#0b6cff",textDecoration:"none",fontSize:"14px",fontWeight:"500"});var u=o("a","onbe-privacy-link","Privacy Policy →");u.setAttribute("href","#"),u.setAttribute("target","_blank"),i(u,{color:e.cfg.primaryColor||"#0b6cff",textDecoration:"none",fontSize:"14px",fontWeight:"500"}),l.appendChild(p),l.appendChild(u),c.appendChild(s),c.appendChild(l);var f=o("label","onbe-checkbox-label");i(f,{display:"flex",alignItems:"center",gap:"10px",marginBottom:"20px",cursor:"pointer"});var h=o("input","onbe-checkbox");h.type="checkbox",i(h,{width:"18px",height:"18px",cursor:"pointer"});var b=o("span","onbe-checkbox-text","I have read and agree to the terms and conditions");i(b,{fontSize:"14px",color:"#333"}),f.appendChild(h),f.appendChild(b);var v=o("div","onbe-buttons-container");i(v,{display:"flex",gap:"12px"});var g=o("button","onbe-decline-btn","Decline");i(g,{flex:"1",padding:"12px",background:"#fff",color:"#666",border:"2px solid #e0e0e0",borderRadius:"8px",fontSize:"15px",fontWeight:"600",cursor:"pointer"});var x=o("button","onbe-accept-btn","Accept");i(x,{flex:"1",padding:"12px",background:e.cfg.primaryColor||"#0b6cff",color:"white",border:"none",borderRadius:"8px",fontSize:"15px",fontWeight:"600",cursor:"not-allowed",opacity:"0.5"}),x.disabled=!0,h.addEventListener("change",function(){h.checked?(x.disabled=!1,i(x,{cursor:"pointer",opacity:"1"})):(x.disabled=!0,i(x,{cursor:"not-allowed",opacity:"0.5"}))}),x.addEventListener("click",function(){x.disabled||(n.innerHTML="",e.fetchAndRenderCard(),t())}),g.addEventListener("click",function(){n.innerHTML="";var e=o("div","onbe-decline-msg","You have declined the terms. Please refresh to try again.");i(e,{textAlign:"center",padding:"20px",color:"#666",fontSize:"14px"}),n.appendChild(e)}),v.appendChild(g),v.appendChild(x),r.appendChild(a),r.appendChild(d),r.appendChild(c),r.appendChild(f),r.appendChild(v),n.appendChild(r)}}})]})})},d.prototype.fetchAndRenderCard=function(){return t(this,void 0,void 0,function(){var e,t,r;return n(this,function(n){switch(n.label){case 0:this.showLoadingBar("Loading your card..."),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.fetchCardDetails()];case 2:return e=n.sent(),this.hideLoadingBar(),this.renderCard(e),[3,4];case 3:return t=n.sent(),console.error("RebateSDK: Failed to fetch and render card",t),this.hideLoadingBar(),this.rootEl&&(i(r=o("div","onbe-error"),{color:"#d32f2f",padding:"12px",textAlign:"center",fontSize:"14px"}),r.textContent="Unable to load card details. Please try again later.",this.rootEl.appendChild(r)),[3,4];case 4:return[2]}})})},d.prototype.showLoadingBar=function(e){if(void 0===e&&(e="Loading your card..."),this.rootEl){var t=o("div","onbe-loading-container");i(t,{padding:"24px",textAlign:"center"});var n=o("div","onbe-loading-text",e);i(n,{fontSize:"14px",color:"#666",marginBottom:"16px",fontWeight:"500"});var r=o("div","onbe-progress-bg");i(r,{width:"100%",height:"6px",background:"#e0e0e0",borderRadius:"3px",overflow:"hidden",position:"relative"});var a=o("div","onbe-progress-bar");i(a,{width:"0%",height:"100%",background:"linear-gradient(90deg, ".concat(this.cfg.primaryColor||"#0b6cff",", ").concat(this.cfg.secondaryColor||"#6ec1ff",")"),borderRadius:"3px",transition:"width 0.3s ease",animation:"onbe-progress 2s ease-in-out infinite"});var d=o("style");d.innerHTML="\n      @keyframes onbe-progress {\n        0% { width: 0%; }\n        50% { width: 70%; }\n        100% { width: 100%; }\n      }\n    ",document.head.appendChild(d),r.appendChild(a),t.appendChild(n),t.appendChild(r);var c=this.rootEl.querySelector(".onbe-rebate-card-holder");c&&c.appendChild(t)}},d.prototype.hideLoadingBar=function(){if(this.rootEl){var e=this.rootEl.querySelector(".onbe-rebate-card-holder");if(e){var t=e.querySelector(".onbe-loading-container");t&&t.remove()}}},d.prototype.fetchCardDetails=function(){return t(this,void 0,void 0,function(){var t,o,i,d,c,s,l;return n(this,function(n){switch(n.label){case 0:return n.trys.push([0,5,,6]),[4,fetch(r,{method:"GET",headers:{Accept:"application/json"},cache:"no-store"})];case 1:return t=n.sent(),console.log("RebateSDK: fetch to",r,"status",t.status),t.ok?[4,t.json()]:[3,3];case 2:return o=n.sent(),console.log("RebateSDK: server response",o),i=(null===(s=this.cfg.customer)||void 0===s?void 0:s.firstName)?"".concat(this.cfg.customer.firstName," ").concat(this.cfg.customer.lastName||"").trim():void 0,[2,{cardholderName:o.cardholderName||i||a.cardholderName,cardNumber:o.cardNumber||a.cardNumber,cvv:o.cvv||a.cvv,expiry:o.expiry||a.expiry}];case 3:console.warn("RebateSDK: server returned non-ok status",t.status),n.label=4;case 4:return[3,6];case 5:return d=n.sent(),console.warn("RebateSDK: failed to fetch from server, falling back to mock",d),[3,6];case 6:return[4,new Promise(function(e){return setTimeout(e,600)})];case 7:return n.sent(),c=(null===(l=this.cfg.customer)||void 0===l?void 0:l.firstName)?"".concat(this.cfg.customer.firstName," ").concat(this.cfg.customer.lastName||"").trim():a.cardholderName,[2,e(e({},a),{cardholderName:c})]}})})},d.prototype.maskCardNumber=function(e){var t=e.replace(/\s/g,"").slice(-4);return"•••• •••• •••• ".concat(t)},d.prototype.renderCard=function(e){if(this.rootEl){var t=this.rootEl.querySelector(".onbe-rebate-card-holder");if(t){t.innerHTML="";var n=o("div","onbe-card");i(n,this.cardStyles());var r=this.maskCardNumber(e.cardNumber),a=o("div","onbe-card-image");i(a,{marginTop:"12px",position:"relative",width:"100%",paddingBottom:"63%",background:"linear-gradient(135deg, ".concat(this.cfg.primaryColor||"#0b6cff",", ").concat(this.cfg.secondaryColor||"#6ec1ff",")"),borderRadius:"12px",color:"#fff",boxSizing:"border-box",overflow:"hidden"});var d=o("div","onbe-card-content");if(i(d,{position:"absolute",top:0,left:0,right:0,bottom:0,padding:"16px",display:"flex",flexDirection:"column",justifyContent:"flex-start"}),a.appendChild(d),this.cfg.companyName){var c=o("div","onbe-company-in-card",this.cfg.companyName);i(c,{position:"absolute",top:"12px",left:"16px",fontSize:"14px",fontWeight:"700",color:"rgba(255,255,255,0.95)"}),a.appendChild(c)}var s=o("div","onbe-card-number",r);i(s,{fontSize:"20px",letterSpacing:"2px",fontFamily:"monospace",fontWeight:"500",whiteSpace:"nowrap",textAlign:"left",margin:"74px 0 8px 16px",overflow:"hidden",textOverflow:"ellipsis"}),d.appendChild(s);var l=o("div","onbe-cardholder-name",e.cardholderName);i(l,{fontSize:"14px",fontWeight:"600",color:"rgba(255,255,255,0.95)",textAlign:"left",marginTop:"6px",marginLeft:"16px"}),d.appendChild(l);var p=o("div","onbe-card-meta");i(p,{display:"flex",justifyContent:"space-between",alignItems:"flex-end",marginTop:"auto"});var u=o("div","onbe-card-expiry");i(u,{display:"flex",flexDirection:"column",gap:"1px"}),u.innerHTML='\n      <div style="color:rgba(255,255,255,0.7);font-size:9px;text-transform:uppercase;margin-bottom:1px">Exp</div>\n      <div style="font-size:13px">'.concat(e.expiry||"","</div>\n    ");var f=o("div","onbe-card-cvv");i(f,{textAlign:"right",display:"flex",flexDirection:"column",gap:"1px"}),f.innerHTML='\n      <div style="color:rgba(255,255,255,0.7);font-size:9px;text-transform:uppercase;margin-bottom:1px">CVV</div>\n      <div style="font-size:13px">•••</div>\n    ',p.appendChild(u),p.appendChild(f),d.appendChild(p),n.appendChild(a);var h=o("button","onbe-collapse-toggle","Show details");i(h,{marginTop:"8px",background:"transparent",border:"none",color:this.cfg.primaryColor||"#0b6cff",cursor:"pointer"});var b=o("div","onbe-details-box");i(b,{marginTop:"8px",padding:"8px",borderRadius:"6px",background:"#f7f7f7",display:"none"}),b.innerHTML="\n      <div><strong>Card Number:</strong> ".concat(e.cardNumber,"</div>\n      <div><strong>CVV:</strong> ").concat(e.cvv,"</div>\n      <div><strong>Expiry:</strong> ").concat(e.expiry,"</div>\n    "),h.addEventListener("click",function(){"none"!==b.style.display&&b.style.display?(b.style.display="none",h.innerHTML="Show details"):(b.style.display="block",h.innerHTML="Hide details")}),n.appendChild(h),n.appendChild(b),t.appendChild(n),this.renderAddToWalletButton(t)}}},d.prototype.renderAddToWalletButton=function(e){var t=o("div","onbe-wallet-container");i(t,{marginTop:"16px",display:"flex",justifyContent:"center"});var n=o("button","onbe-wallet-btn");i(n,{width:"100%",maxWidth:"320px",padding:"12px 16px",background:"#000",color:"#fff",border:"none",borderRadius:"8px",fontSize:"15px",fontWeight:"600",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",transition:"background 0.2s"});n.innerHTML="".concat('\n      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n        <path d="M21 18v1c0 1.1-.9 2-2 2H5c-1.11 0-2-.9-2-2V5c0-1.1.89-2 2-2h14c1.1 0 2 .9 2 2v1h-9c-1.11 0-2 .9-2 2v8c0 1.1.89 2 2 2h9zm-9-2h10V8H12v8zm4-2.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z" fill="currentColor"/>\n      </svg>\n    ',"<span>Add to Wallet</span>"),n.addEventListener("mouseenter",function(){i(n,{background:"#333"})}),n.addEventListener("mouseleave",function(){i(n,{background:"#000"})}),n.addEventListener("click",function(){alert("Add to Wallet functionality will be integrated with Apple Wallet and Google Pay in production.")}),t.appendChild(n),e.appendChild(t)},d.prototype.cardStyles=function(){return{background:"transparent"}},d}();export{d as RebateSDK};
//# sourceMappingURL=index.esm.js.map
